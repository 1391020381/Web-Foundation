# 原理
## DNS原理
* DNS(Domain Name System,域名系统),作为域名和IP地址相互映射的一个分布式数据库。当浏览器访问一个域名的时候,需要解析一次DNS,获得对应域名的ip地址。在解析过程中,按照浏览器缓存、系统缓存、路由器缓存、ISP(运营商)DNS缓存、根域服务器、顶级域名服务器、主域名服务器 顺序,逐步读取缓存，直到拿到IP地址。
## DNS Prefetch原理
* DNS Prefetch就是根据浏览器定义的规则,提前解析之后可能会用到的域名,使解析结果缓存到 系统缓存中 ,缩短DNS解析时间,来提高网站的访问速度。
* Chromium不使用浏览器的网络堆栈，直接使用操作系统的缓存。通过8个异步线程执行预解析，每个线程处理一个队列，来等待域名的响应，最终操作系统会响应一个DNS结果给线程，然后线程丢弃它，等待下一个预解析请求。
## 如何使用 DNS Prefetch
1. 自动解析
    * Chromium使用超链接的 href属性来查找要预解析的主机名。当遇到a标签,Chromium会自动将href中的域名解析为IP地址,这个解析过程与用户浏览网页并行处理的。但是为了确保安全性,在HTTPS页面中不会自动解析。
2. 手动解析
    * 在页面添加如下标记  <link rel="dns-prefetch" href="//img.alicdn.com">  link标签会让Chromium预取img.alicdn.com的解析    
3. 自动解析控制
    * 当我们希望在HTTPS页面开启自动解析功能时,添加如下标记
    * <meta http-equiv="x-dns-prefetch-control" content="on">
    * 当我们希望在HTTP页面关闭自动解析功能时,添加如下标记
    * <meta http-equiv="x-dns-prefetch-control" content="off">    
# 解决的问题及收益
   * DNS Prefetch有效缩短了DNS的解析时间。如果浏览器最近将一个域名解析为IP地址,所属的操作系统将会缓存,下次DNS解析时间可以低至0-1ms
如果结果不在系统本地缓存,则需要读取路由器的缓存,则解析时间的最小值大约为15ms。如果路由器缓存也不存在,则需要读取ISP(运营商)DSN缓存,一般像taobao.com baidu.com这些常见域名,读取ISP(运营商)DN缓存需要的时间在80-120ms,如果是不常见的域名,平均需要200ms - 300ms。一般的网站在运营商这里都能查询的到，所以普遍来说DNS Prefetch可以给一个域名的DNS解析过程带来15-300ms的提升，尤其是一些大量引用很多其他域名资源的网站，提升效果就更加明显了。
Chromium对底层缓存进行了建模，当Chrome浏览器启动的时候，就会自动的快速解析浏览器最近一次启动时记录的前10个域名。所以你经常访问的网址就没有DNS解析的延迟，打开速度更快。